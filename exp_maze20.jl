include("method_existing.jl")
include("method_QMIX.jl")

# The following matrix and data for maze20 probelm are from Tony's POMDP website:
# www.pomdp.org

n_s = 20; n_a = 6; n_o = 8;

T = zeros(Float64,n_s,n_a,n_s)
O = zeros(Float64,n_s,n_a,n_o)
R = zeros(Float64,n_s,n_a,n_s)

Ta0 = [
    [0.15 0.15 0 0 0 0.7 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0.15 0.7 0.15 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0.15 0.7 0.15 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0.15 0 0.15 0 0 0 0.7 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0.15 0.85 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0.15 0.15 0 0 0 0.7 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0.15 0.15 0 0 0 0 0.7 0 0 0 0 0 0 0 0 ]
    ;[0.3 0 0 0 0.3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.4 ]
    ;[0 0 0 0 0 0 0 0 0.85 0.15 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0.15 0.15 0 0 0 0 0.7 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0.15 0.15 0 0 0 0.7 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0.15 0.85 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0.3 0 0 0 0 0.7 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 0.15 0.15 0 0 0 0.7 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 0.15 0.85 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.85 0.15 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.15 0.7 0.15 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.15 0.7 0.15 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.15 0.7 0.15 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.15 0.85 ]
];

Ta1 = [
    [0.85 0.15 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0.15 0.7 0.15 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0.15 0.7 0.15 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0.15 0.7 0.15 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0.15 0.85 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0.7 0 0 0 0 0.15 0.15 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0.15 0.85 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0.3 0 0 0 0.3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.4 ]
    ;[0 0 0 0.7 0 0 0 0 0.15 0.15 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0.15 0.85 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0.7 0 0 0 0 0.15 0.15 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0.7 0 0 0 0.15 0.15 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0.7 0 0 0 0 0.3 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 0.85 0.15 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0.7 0 0 0 0.15 0.15 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0.7 0 0 0 0 0.15 0.15 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.15 0.7 0.15 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0.7 0 0 0 0.15 0 0.15 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 0.7 0 0 0 0.15 0 0.15 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.15 0.85 ]
];


Ta2 = [
    [0.15 0.7 0 0 0 0.15 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0.3 0.7 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0.3 0.7 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0.15 0.7 0 0 0 0.15 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 1.0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0.15 0 0 0 0 0 0.7 0 0 0 0.15 0 0 0 0 0 0 0 0 0]
    ;[0 0 0 0 0 0 0.85 0 0 0 0 0.15 0 0 0 0 0 0 0 0 ]
    ;[0.3 0 0 0 0.3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.4 ]
    ;[0 0 0 0.15 0 0 0 0 0.15 0.7 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0.85 0 0 0 0 0.15 0 0 0 0 0 ]
    ;[0 0 0 0 0 0.15 0 0 0 0 0 0.7 0 0 0 0.15 0 0 0 0 ]
    ;[0 0 0 0 0 0 0.15 0 0 0 0 0.85 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0.15 0 0 0 0 0.7 0 0 0 0 0.15 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 0.15 0.7 0 0 0 0.15 0 ]
    ;[0 0 0 0 0 0 0 0 0 0.15 0 0 0 0 0.85 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0.15 0 0 0 0 0.15 0.7 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.7 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0.15 0 0 0 0 0.15 0.7 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 0.15 0 0 0 0 0.15 0.7 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1.0 ]
];

Ta3 = [
    [0.85 0 0 0 0 0.15 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0.7 0.3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0.7 0.3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0.7 0.15 0 0 0 0 0.15 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0.7 0.3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0.15 0 0 0 0 0.7 0 0 0 0 0.15 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0.7 0.15 0 0 0 0 0.15 0 0 0 0 0 0 0 0 ]
    ;[0.3 0 0 0 0.3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.4 ]
    ;[0 0 0 0.15 0 0 0 0 0.85 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0.7 0.15 0 0 0 0 0.15 0 0 0 0 0 ]
    ;[0 0 0 0 0 0.15 0 0 0 0 0.7 0 0 0 0 0.15 0 0 0 0 ]
    ;[0 0 0 0 0 0 0.15 0 0 0 0.7 0.15 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0.15 0 0 0 0 0.7 0 0 0 0 0.15 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 0.85 0 0 0 0 0.15 0 ]
    ;[0 0 0 0 0 0 0 0 0 0.15 0 0 0 0.7 0.15 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0.15 0 0 0 0 0.85 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.7 0.3 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0.15 0 0 0 0.7 0.15 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 0.15 0 0 0 0.7 0.15 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.7 0.3   ]
];

Ta4 = [
    [1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 ]
];

Ta5 =[
     [1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 ]
    ;[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1]];

for i = 1 : n_s
    for j = 1 : n_s
        T[i,1,j] = Ta0[i,j]
        T[i,2,j] = Ta1[i,j]
        T[i,3,j] = Ta2[i,j]
        T[i,4,j] = Ta3[i,j]
        T[i,5,j] = Ta4[i,j]
        T[i,6,j] = Ta5[i,j]
    end
end

Oa0 = [
    [1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
];

Oa1 = [
    [1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]];

Oa2 = [
    [1 0 0 0 0 0 0 0]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
];

Oa3 = [
    [1 0 0 0 0 0 0 0]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0 ]
    ;[1 0 0 0 0 0 0 0]
];

Oa4 = [
    [0 0.14 0.01 0.8 0.05 0 0 0 ]
    ;[0 0.05 0.1 0.1 0.75 0 0 0 ]
    ;[0 0.05 0.1 0.1 0.75 0 0 0 ]
    ;[0 0.14 0.01 0.8 0.05 0 0 0 ]
    ;[0 0.05 0.1 0.1 0.75 0 0 0 ]
    ;[0 0.89 0.05 0.05 0.01 0 0 0 ]
    ;[0 0.14 0.01 0.8 0.05 0 0 0 ]
    ;[0 0.14 0.01 0.8 0.05 0 0 0 ]
    ;[0 0.14 0.8 0.01 0.05 0 0 0 ]
    ;[0 0.14 0.01 0.8 0.05 0 0 0 ]
    ;[0 0.89 0.05 0.05 0.01 0 0 0 ]
    ;[0 0.14 0.8 0.01 0.05 0 0 0 ]
    ;[0 0.89 0.05 0.05 0.01 0 0 0 ]
    ;[0 0.14 0.01 0.8 0.05 0 0 0 ]
    ;[0 0.14 0.8 0.01 0.05 0 0 0 ]
    ;[0 0.14 0.8 0.01 0.05 0 0 0 ]
    ;[0 0.05 0.1 0.1 0.75 0 0 0 ]
    ;[0 0.14 0.8 0.01 0.05 0 0 0 ]
    ;[0 0.14 0.8 0.01 0.05 0 0 0 ]
    ;[0 0.05 0.1 0.1 0.75 0 0 0]
];

Oa5 = [
    [0 0.14 0 0 0 0.01 0.8 0.05 ]
    ;[0 0.89 0 0 0 0.05 0.05 0.01 ]
    ;[0 0.89 0 0 0 0.05 0.05 0.01 ]
    ;[0 0.89 0 0 0 0.05 0.05 0.01 ]
    ;[0 0.14 0 0 0 0.8 0.01 0.05 ]
    ;[0 0.14 0 0 0 0.01 0.8 0.05 ]
    ;[0 0.14 0 0 0 0.8 0.01 0.05 ]
    ;[0 0.05 0 0 0 0.1 0.1 0.75 ]
    ;[0 0.14 0 0 0 0.01 0.8 0.05 ]
    ;[0 0.14 0 0 0 0.8 0.01 0.05 ]
    ;[0 0.14 0 0 0 0.01 0.8 0.05 ]
    ;[0 0.14 0 0 0 0.8 0.01 0.05 ]
    ;[0 0.05 0 0 0 0.1 0.1 0.75 ]
    ;[0 0.14 0 0 0 0.01 0.8 0.05 ]
    ;[0 0.14 0 0 0 0.8 0.01 0.05 ]
    ;[0 0.14 0 0 0 0.01 0.8 0.05 ]
    ;[0 0.89 0 0 0 0.05 0.05 0.01 ]
    ;[0 0.89 0 0 0 0.05 0.05 0.01 ]
    ;[0 0.89 0 0 0 0.05 0.05 0.01 ]
    ;[0 0.14 0 0 0 0.8 0.01 0.05 ]];

for i = 1 : n_s
    for j = 1 : n_o
        O[i,1,j] = Oa0[i,j]
        O[i,2,j] = Oa1[i,j]
        O[i,3,j] = Oa2[i,j]
        O[i,4,j] = Oa3[i,j]
        O[i,5,j] = Oa4[i,j]
        O[i,6,j] = Oa5[i,j]
    end
end

a0_list = [3.4 1.2 1.2 4.0 0.6 3.4 3.4 150.0 0.6 3.4 3.4 0.6 2.8 3.4 0.6 0.6 1.2 1.2 1.2 0.6]
a1_list = [0.6 1.2 1.2 1.2 0.6 3.4 0.6 150.0 3.4 0.6 3.4 3.4 2.8 0.6 3.4 3.4 1.2 4.0 4.0 0.6]
a2_list = [3.4 2.8 2.8 3.4 0.0 4.0 0.6 150.0 3.4 0.6 4.0 0.6 1.2 3.4 0.6 3.4 2.8 3.4 3.4 0.0]
a3_list = [0.6 2.8 2.8 3.4 2.8 1.2 3.4 150.0 0.6 3.4 1.2 3.4 1.2 0.6 3.4 0.6 2.8 3.4 3.4 2.8]

for i = 1 : n_s
    for j = 1 : n_s
        R[i,1,j] = a0_list[i]
        R[i,2,j] = a1_list[i]
        R[i,3,j] = a2_list[i]
        R[i,4,j] = a3_list[i]
        R[i,5,j] = 2.0
        R[i,6,j] = 2.0
    end
end


################################################
############ Simulation  Function ##############
################################################

function one_maze20_trial(
    T      :: Array{Float64,3}, # transition model (s,a,s')
    R      :: Array{Float64,3}, # reward model (s,a,s')
    O      :: Array{Float64,3}, # observation model (s,a,o)
    t_step :: Int64,            # simluation length
    alpha  :: Matrix{Float64},  # alpha vectors help to decide action
    gamma  :: Float64,          # discount factor
    )

    n_s = size(T,1)
    n_a = size(T,2)
    n_o = size(O,3)

    # initial belief (given by the file)
    b = zeros(Float64,n_s)
    b[1] = 0.3; b[5] = 0.3; b[20] = 0.4;

    # Initialize state
    x = 0
    initi = rand()
    if initi < 0.3
        x = 1
    elseif initi < 0.6
        x = 5
    else
        x = 20
    end

    # intialize total reward
    total_r = 0.0

    for t = 1 : t_step

        # Choose the action
        action_to_do = action_to_take(b,alpha)

        # Get reward and the next state
        (xp,r) = tran_reward_sampling(T,R,x,action_to_do)
        total_r += r *  ((gamma)^t)

        # Get observation
        o = observe_sampling(O,xp,action_to_do)

        # update the belief
        bp = belief_update(b,action_to_do,o,T,O)

        # printing
        #println("Time Step = ",t)
        #println("S,A,O,R,SP",(x,action_to_do,o,r,xp))

        # update
        b = bp
        x = xp

    end

    return (total_r)

end

function one_maze20_trial_2(
    T      :: Array{Float64,3}, # transition model (s,a,s')
    R      :: Array{Float64,3}, # reward model (s,a,s')
    O      :: Array{Float64,3}, # observation model (s,a,o)
    t_step :: Int64,            # simluation length
    alpha  :: Matrix{Float64},  # alpha vectors help to decide action
    gamma  :: Float64,          # discount factor
    )

    n_s = size(T,1)
    n_a = size(T,2)
    n_o = size(O,3)

    # initial belief
    b = ones(Float64,n_s) * (1.0/n_s)

    # Initialize state (uniformly over all states)
    x = round(Int64,div(rand()*20,1)) + 1

    # intialize total reward
    total_r = 0.0

    for t = 1 : t_step

        # Choose the action
        action_to_do = action_to_take(b,alpha)

        # Get reward and the next state
        (xp,r) = tran_reward_sampling(T,R,x,action_to_do)
        total_r += r *  ((gamma)^t)

        # Get observation
        o = observe_sampling(O,xp,action_to_do)

        # update the belief
        bp = belief_update(b,action_to_do,o,T,O)

        # printing
        #println("Time Step = ",t)
        #println("S,A,O,R,SP",(x,action_to_do,o,r,xp))

        # update
        b = bp
        x = xp

    end

    return (total_r)

end

#############################################
############ Run Simulation #################
#############################################

gamma_simulation = 0.9
grid = 100

gamma_p = collect(linspace(gamma_simulation, 0.5, grid))
QMDP_r = zeros(Float64,grid)
UMDP_r = zeros(Float64,grid)
FIB_r = zeros(Float64,grid)


for (reduced_time, gamma) in enumerate(gamma_p)

    println(reduced_time)

    #redu_f = 1 + 0.1 * (reduced_time - 1)

    QMDP_alpha = Q_value_iteration(zeros(Float64,n_s,n_a),T,R,0.01,gamma)
    QUMDP_alpha = QUMDP(zeros(Float64,n_s,n_a),T,R,0.01,gamma)
    FIB_alpha = FIB(zeros(Float64,n_s,n_a),T,R,O,0.01,gamma)

    QMDP_r_sum = 0.0
    QUMDP_r_sum = 0.0
    FIB_r_sum = 0.0

    t_trial = 2000
    t_step = 60

    for i = 1 : t_trial

        QMDP_r_sum += one_maze20_trial(T,R,O,t_step,QMDP_alpha,gamma_simulation)
        QUMDP_r_sum += one_maze20_trial(T,R,O,t_step,QUMDP_alpha,gamma_simulation)
        FIB_r_sum += one_maze20_trial(T,R,O,t_step,FIB_alpha,gamma_simulation)

    end

    QMDP_r[reduced_time] = QMDP_r_sum/t_trial
    UMDP_r[reduced_time] = QUMDP_r_sum/t_trial
    FIB_r[reduced_time] = FIB_r_sum/t_trial

end


plot(gamma_p,QMDP_r,label="QMDP")
plot(gamma_p,UMDP_r,label="UMDP")
plot(gamma_p,FIB_r,label="FIB")
xlabel("reduced factor")
ylabel("Discounted Reward")
title("Maze20 with gamma 0.90 and concentrated initial belief")
legend(loc="upper right",fancybox="true")
annotate("SARSOP = 50.94",
	xy=[1;0],
	xycoords="axes fraction",
	xytext=[-10,10],
	textcoords="offset points",
	fontsize=12.0,
	ha="right",
	va="bottom")
